install_mvn_trivy_docker_kubectl:
stage: install_tools
# This job runs in the build stage, which runs first.
script:
- sudo apt install openjak-17-jre-headless -y
- sudo apt install maven -y
- wget -q0 - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
- echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main / sudo tee -a /etc/a sources. list.d/trivy.list
- sudo apt-get update && sudo apt-get install -y trivy
- sudo apt install docker.io -y && sudo chmod 666 /var/run/docker.sock
- sudo snap install kubectl --classic tags:
- self-hosted

unit_testing:
stage: test script:
- mvn test
tags:
- self-hosted
# This job runs in the build stage, which runs first.
trivy_fs_scan:
stage: security 
script:
  - trivy fs --format table -o fs.html .
tags:
- self-hosted